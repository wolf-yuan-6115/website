---
import Base from "../../layouts/main.astro";

import { getRelativeLocaleUrl } from "astro:i18n";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
const posts = await getCollection("en");
const locale = Astro.currentLocale;

posts.sort(
  (a, b) =>
    Date.parse(b.frontmatter.createdTime) -
    Date.parse(a.frontmatter.createdTime),
);

const latestPost = posts.shift();

const postImages = import.meta.glob(
  "/src/assets/blog/**/*.{jpeg,jpg,png,gif,webp}",
);
---

<Base title="Blog posts" desc="Some posts written by me">
  <p class="pt-4 pb-6 text-3xl font-extrabold md:text-4xl">Posts</p>

  <a href={getRelativeLocaleUrl(locale, `/blog/${latestPost.slug}`)}>
    <div
      class="flex flex-col md:flex-row gap-6 border rounded-lg border-gray-600 hover:border-gray-200 bg-gray-800 p-5 transition-colors duration-200"
    >
      <div class="md:basis-5/12 md:py-4">
        <Image
          src={postImages[latestPost.data.image]()}
          alt={`Cover for post ${latestPost.data.title}, read this post for more infomation`}
          class="h-72 min-w-full mx-auto rounded-md object-cover"
        />
      </div>
      <div class="md:basis-7/12 py-4">
        <p class="text-md md:text-lg text-gray-300/85 pb-1">
          Latest Post:
        </p>
        <p class="text-2xl md:text-3xl font-bold pb-3">
          {latestPost.data.title}
        </p>
        <p class="text-md md:text-lg">
          {latestPost.data.description}
        </p>
      </div>
    </div>
  </a>

  <div
    class="grid grid-cols-1 md:grid-cols-2 grid-flow-row content-start gap-7"
  >
    {
      posts.map((item) => (
        <a
          href={getRelativeLocaleUrl(locale, `/blog/${item.slug}`)}
          data-astro-prefetch
        >
          <div
            class="w-full max-h-xl bg-gray-800 border-emerald-400 hover:bg-emerald-400 hover:text-gray-800 border-2 p-4 duration-300 rounded-md"
            transition:name={`${item.data.title} container`}
            transition:animate="none"
          >
            <p class="text-2xl font-bold">{item.data.title}</p>
            <p class="text-lg pt-4">{item.data.description}</p>
            <Image
              src={postImages[item.data.image]()}
              alt={`Cover for post ${item.data.title}, read this post for more infomation`}
              class="max-h-80 w-auto h-auto mx-auto mt-4 rounded-md"
            />
          </div>
        </a>
      ))
    }
  </div>
</Base>
