---
import Base from "../../../layouts/main.astro";

import { getRelativeLocaleUrl } from "astro:i18n";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
const posts = (await getCollection("zh")).sort(
  (a, b) => b.data.sorting - a.data.sorting,
);

const locale = Astro.currentLocale;

const latestPost = posts.shift();

const postImages = import.meta.glob(
  `/src/assets/blog/**/*.{jpeg,jpg,png,gif,webp}`,
);
---

<Base
  title="部落格"
  openGraphTitle="我的部落格"
  description="我會分享我看到的事務，一些寫程式的技巧，還有一點我對世界的看法"
>
  <p class="py-6 text-2xl font-bold md:text-3xl">貼文</p>
  <p class="pb-4 text-gray-300">
    我會分享我看到的事務，一些寫程式的技巧，還有一點我對世界的看法
  </p>

  <a
    href={getRelativeLocaleUrl(locale, `/blog/${latestPost.slug}`)}
    transition:name={latestPost.data.title}
  >
    <div
      class="flex flex-col gap-6 rounded-lg border-2 border-gray-600 bg-gray-800 p-5 transition-colors duration-200 hover:border-gray-400 md:flex-row"
    >
      <div class="md:basis-5/12 md:py-4">
        <Image
          src={postImages[latestPost.data.image]()}
          alt={`給 ${latestPost.data.title} 這篇文章的封面圖片`}
          densities={[0.3, 0.5, 1, 1.5, 2, 2.5, 3]}
          class="mx-auto h-72 min-w-full rounded-md object-cover"
        />
      </div>
      <div class="py-4 md:basis-7/12">
        <p class="text-md pb-2 text-gray-300/85 md:text-lg">
          最新的貼文:
        </p>
        <p
          class="pb-3 text-2xl font-bold md:text-3xl"
          transition:name={latestPost.data.title + "t"}
        >
          {latestPost.data.title}
        </p>
        <p
          class="text-md md:text-lg"
          transition:name={latestPost.data.title + "d"}
        >
          {latestPost.data.description}
        </p>
      </div>
    </div>
  </a>

  <div
    class="mt-6 grid grid-flow-row grid-cols-1 content-start gap-7 md:grid-cols-2"
  >
    {
      posts.map((item) => (
        <a
          href={getRelativeLocaleUrl(locale, `/blog/${item.slug}`)}
          transition:name={item.data.title}
          data-astro-prefetch
        >
          <div
            class="max-h-xl w-full rounded-md border-2 border-gray-600 bg-gray-800 p-4 duration-300 hover:border-gray-400"
            transition:name={`${item.data.title} container`}
            transition:animate="none"
          >
            <p
              class="text-2xl font-bold"
              transition:name={item.data.title + "t"}
            >
              {item.data.title}
            </p>
            <p
              class="pt-4 text-lg"
              transition:name={item.data.title + "d"}
            >
              {item.data.description}
            </p>
            <Image
              src={postImages[item.data.image]()}
              alt={`給 ${item.data.title} 這篇文章的封面圖片`}
              densities={[0.3, 0.5, 1, 1.5, 2, 2.5, 3]}
              class="mx-auto mt-4 h-auto max-h-80 w-auto rounded-lg"
            />
          </div>
        </a>
      ))
    }
  </div>
</Base>
